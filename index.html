<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quiz đơn giản</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;min-height:100vh;display:grid;place-items:center;background:#fafafa;color:#111}
    main{width:min(520px,100%);background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:20px}
    h1{margin:0 0 10px;font-size:18px}
    p{margin:0 0 12px;color:#475569}
    input{width:100%;padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px;font-size:15px}
    button{margin-top:10px;width:100%;padding:10px 12px;border:0;border-radius:10px;background:#111;color:#fff;font-weight:700;cursor:pointer}
    .msg{margin-top:10px;font-size:14px;display:none}
    .ok{display:block;color:#166534}
    .err{display:block;color:#b91c1c}
  </style>
</head>
<body>
  <main>
    <h1>Trả lời đúng để tiếp tục</h1>
    <p><strong>Câu hỏi:</strong> 7 + 5 = ?</p>
    <form id="f" autocomplete="off">
      <input id="a" type="text" placeholder="Nhập đáp án..." />
      <button type="submit">Gửi</button>
      <div id="m" class="msg" aria-live="polite"></div>
    </form>
  </main>

<script>
/*
 - MỤC ĐÍCH: admin 24h internal measurement
 - Hành vi: khi trả lời đúng -> mở REF_URL (tab mới) + chuyển tab hiện tại tới FINAL_URL
 - Fallback: nếu popup bị chặn thì chuyển tab hiện tại tới REF_URL (và sau 300ms tới FINAL_URL)
 - Thêm beacon để đo (tuỳ chỉnh endpoint)
*/

const CORRECT = ["12","mười hai"];
const REF_URL = "https://www.24h.com.vn/";
const FINAL_URL = "https://web.wwin79.pro/?a=1a36797027f05aef97aa91d942410619&utm_campaign=googleads&utm_source=inhouse&utm_medium=search&utm_term=%7Bkeyword%7D&utm_content=keybrand";

// (tuỳ bạn) một endpoint nội bộ để ghi sự kiện; đổi thành đường dẫn server của bạn hoặc remove nếu không cần
const BEACON_URL = "/beacon"; // ví dụ: "/collect-quiz-hit"

document.getElementById("f").addEventListener("submit", (e) => {
  e.preventDefault();
  const input = document.getElementById("a");
  const v = (input.value || "").trim().toLowerCase();
  const m = document.getElementById("m");
  const ok = CORRECT.map(s=>s.toLowerCase()).includes(v);

  if (!ok) {
    m.textContent = "Sai rồi, thử lại nhé!";
    m.className = "msg err";
    return;
  }

  // Đúng rồi
  m.textContent = "Đúng rồi! Đang xử lý...";
  m.className = "msg ok";

  // Gửi beacon (non-blocking) để server nội bộ biết user đã trả lời đúng
  try {
    const payload = JSON.stringify({
      event: "quiz_correct",
      question: "7+5",
      timestamp: Date.now(),
      // thêm thông tin bạn muốn: campaign id, utm, user id (nếu hợp lệ)
    });
    // dùng navigator.sendBeacon khi có, fallback fetch không chặn
    if (navigator.sendBeacon) {
      const blob = new Blob([payload], { type: 'application/json' });
      navigator.sendBeacon(BEACON_URL, blob);
    } else {
      // không chặn thread
      fetch(BEACON_URL, { method: 'POST', body: payload, headers: {'Content-Type':'application/json'}, keepalive: true }).catch(()=>{});
    }
  } catch(err) {
    // ignore beacon errors
    console.warn('Beacon error', err);
  }

  // Thử mở tab mới (được phép trong event handler do user interaction)
  let opened = null;
  try {
    opened = window.open(REF_URL, '_blank', 'noopener,noreferrer');
  } catch(err) {
    opened = null;
  }

  // Nếu popup bị chặn (opened === null), fallback: chuyển current tab tới REF_URL then to FINAL_URL quickly
  if (!opened) {
    // Một cách: điều hướng current tab đến REF_URL, sau đó setTimeout để chuyển tiếp tới FINAL_URL.
    // Thời gian rất ngắn để trải nghiệm mượt (300ms). Bạn có thể chỉnh.
    window.location.href = REF_URL;
    // Sau khi current tab đến REF_URL, code trong trang đó sẽ chạy; 
    // nhưng nếu bạn muốn ngay lập tức chuyển sang FINAL_URL ở cùng tab, dùng setTimeout:
    setTimeout(() => {
      window.location.href = FINAL_URL;
    }, 300);
    return;
  }

  // Nếu tab mới mở được, ngay lập tức chuyển tab hiện tại tới FINAL_URL
  // (đây là hành vi bạn yêu cầu: mở 24h trong tab mới và sang bài viết trong tab hiện)
  // small delay ensures popup creation completes on some browsers
  setTimeout(() => {
    window.location.href = FINAL_URL;
  }, 50);
});
</script>
</body>
</html>
